#!/bin/bash

set -e

echo "----------------------------------------------------------------------------------------------------"
echo "Copying glslang"
echo "----------------------------------------------------------------------------------------------------"
rm -rf tmp
mkdir tmp
cp -r glslang tmp
pushd tmp/glslang

echo "----------------------------------------------------------------------------------------------------"
echo "Syncing git submodules"
echo "----------------------------------------------------------------------------------------------------"
python3 ./update_glslang_sources.py

echo "----------------------------------------------------------------------------------------------------"
echo "Generating build files"
echo "----------------------------------------------------------------------------------------------------"
mkdir -p build && pushd build
cmake -GNinja -DGLSLANG_TESTS=OFF ..
ninja
popd

echo "----------------------------------------------------------------------------------------------------"
echo "Copying generated headers"
echo "----------------------------------------------------------------------------------------------------"
rm -rf ../../glslang-generated
mkdir -p ../../glslang-generated
cp -r build/include/* ../../glslang-generated

echo "----------------------------------------------------------------------------------------------------"
echo "Cleaning up"
echo "----------------------------------------------------------------------------------------------------"
popd
rm -rf tmp
