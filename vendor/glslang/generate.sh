#!/bin/bash

set -e

echo "----------------------------------------------------------------------------------------------------"
echo "Copying glslang"
echo "----------------------------------------------------------------------------------------------------"
rm -rf tmp
mkdir tmp
cp -r upstream tmp
pushd tmp/upstream

echo "----------------------------------------------------------------------------------------------------"
echo "Syncing git submodules"
echo "----------------------------------------------------------------------------------------------------"
python3 ./update_glslang_sources.py

echo "----------------------------------------------------------------------------------------------------"
echo "Generating build files"
echo "----------------------------------------------------------------------------------------------------"
mkdir -p build && pushd build
cmake -GNinja -DGLSLANG_TESTS=OFF ..
ninja
popd

echo "----------------------------------------------------------------------------------------------------"
echo "Copying generated headers"
echo "----------------------------------------------------------------------------------------------------"
rm -rf ../../generated
mkdir -p ../../generated
cp -r build/include/* ../../generated

echo "----------------------------------------------------------------------------------------------------"
echo "Cleaning up"
echo "----------------------------------------------------------------------------------------------------"
popd
rm -rf tmp
